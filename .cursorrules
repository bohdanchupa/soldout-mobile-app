# Soldout Event Mobile App - Cursor Rules

## Tech Stack
- **Framework**: Quasar v1 (Vue.js 2)
- **State Management**: Vuex
- **HTTP Client**: Axios
- **Mobile**: Apache Cordova (iOS & Android)
- **Styling**: SCSS with custom Gotham Pro font
- **Build**: Webpack via Quasar CLI, Docker for consistency
- **Node Version**: 14 (for Sass compatibility)

## Project Structure

```
org-mobile-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ endpoints.js          # API URLs (TEST/PROD switching)
â”‚   â”œâ”€â”€ assets/                   # Images, fonts, SVGs
â”‚   â”œâ”€â”€ boot/
â”‚   â”‚   â”œâ”€â”€ axios.js              # Axios global config
â”‚   â”‚   â””â”€â”€ cordova.js            # Cordova initialization
â”‚   â”œâ”€â”€ components/               # Reusable Vue components
â”‚   â”œâ”€â”€ css/                      # Global SCSS styles
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ Index.vue             # Main layout with bottom nav
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Login.vue             # Login with Remember Me
â”‚   â”‚   â”œâ”€â”€ Entry.vue             # Dashboard
â”‚   â”‚   â”œâ”€â”€ ListOfEvents.vue      # Events list
â”‚   â”‚   â”œâ”€â”€ Event.vue             # Event details
â”‚   â”‚   â””â”€â”€ Profile.vue           # User profile & logout
â”‚   â”œâ”€â”€ router/                   # Vue Router config
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ module/
â”‚   â”‚       â”œâ”€â”€ state.js          # Vuex state
â”‚   â”‚       â”œâ”€â”€ getters.js        # Vuex getters
â”‚   â”‚       â”œâ”€â”€ mutations.js      # Vuex mutations
â”‚   â”‚       â”œâ”€â”€ actions.js        # API calls & async logic
â”‚   â”‚       â””â”€â”€ index.js          # Module export
â”‚   â””â”€â”€ index.template.html       # HTML template with cordova.js
â”œâ”€â”€ src-cordova/
â”‚   â”œâ”€â”€ config.xml                # Cordova configuration
â”‚   â”œâ”€â”€ package.json              # Cordova plugins
â”‚   â”œâ”€â”€ platforms/                # iOS/Android builds (generated)
â”‚   â”œâ”€â”€ plugins/                  # Cordova plugins (generated)
â”‚   â””â”€â”€ www/                      # Web assets (generated)
â”œâ”€â”€ quasar.conf.js                # Quasar configuration
â””â”€â”€ rebuild-ios.sh                # iOS rebuild helper
```

## API Configuration

### Endpoints (src/api/endpoints.js)
```javascript
// Switch between TEST and PROD
const serviceUrl = 'https://z.soldout.com.ua'        // PROD
// const serviceUrl = 'https://z.test.soldout.com.ua' // TEST

// All endpoints use /main-service/ path
export const epToken = `${serviceUrl}/main-service/oauth/token`
export const epLogin = `${serviceUrl}/main-service/user/get`
```

### Authentication
- **OAuth 2.0** password grant type
- **Client**: `sponsor-client:123456` (Base64: `c3BvbnNvci1jbGllbnQ6MTIzNDU2`)
- **Flow**: 
  1. POST `/oauth/token` with username/password â†’ get access_token
  2. GET `/user/get` with Bearer token â†’ get user info
  3. Save to Vuex + LocalStorage (if Remember Me checked)

### CORS Considerations
- iOS WKWebView sends OPTIONS preflight for custom headers
- ZUUL must have `allow-credentials: true` configured
- Avoid custom headers when possible to prevent preflight

## Vue.js & Quasar Guidelines

### Component Structure
```vue
<template>
  <!-- Quasar components: q-page, q-btn, q-icon, etc. -->
</template>

<script>
export default {
  name: 'ComponentName',
  data() {
    return {
      // Local state
    }
  },
  computed: {
    // Vuex getters via this.$store.getters.getName
  },
  created() {
    // Lifecycle: load data, setup watchers
  },
  methods: {
    // Component methods
  }
}
</script>

<style lang="scss">
  @import '../css/quasar.variables';
  // Component-specific styles
</style>
```

### Vuex Patterns
```javascript
// Actions (async API calls)
export const actionName = async ({ commit }, payload) => {
  try {
    const response = await axios({...})
    commit('mutationName', response.data)
  } catch (err) {
    commit('setError', { error: err })
    return null // Don't throw to prevent UI hanging
  }
}

// Mutations (sync state updates)
export const mutationName = (state, payload) => {
  state.property = payload.value
}

// Getters (computed state)
export const getName = (state) => state.property
```

### LocalStorage
```javascript
import { LocalStorage } from 'quasar'

// Save
LocalStorage.set('key', { data: 'value' })

// Load
const data = LocalStorage.getItem('key')

// Remove
LocalStorage.remove('key')
```

## State Management

### Auth State
```javascript
{
  user: { firstName, lastName, mail, phone, logined },
  accessToken: 'Bearer token',
  error: { status, message, data },
  fetchingData: true/false,
  showDetailsOnEntryScreen: true/false
}
```

### Remember Me Implementation
1. User checks "Remember Me" â†’ save `rememberMe: true`
2. On successful login â†’ save `userData` + `savedAuth` to LocalStorage
3. On app reopen â†’ check `savedAuth` â†’ auto-restore Vuex state â†’ redirect
4. On logout â†’ clear ALL localStorage keys

## Mobile Development (Cordova)

### Cordova Lifecycle
```javascript
// Wait for deviceready before using plugins
document.addEventListener('deviceready', () => {
  console.log('Cordova ready!')
  // Use plugins here: window.cordova.plugin.http
}, false)
```

### iOS Specifics
- **Deployment Target**: iOS 13.0+
- **WebView**: WKWebView (default in Cordova iOS 8.0)
- **Plugins**: cordova-plugin-http (for CORS bypass if needed)
- **Signing**: Requires Apple Developer Account (or free personal team)
- **Build**: Use `rebuild-ios.sh` script for consistency

### Build Process
```bash
# Full iOS rebuild
./rebuild-ios.sh

# Manual steps:
docker exec soldout-app-container npx quasar build
docker cp soldout-app-container:/app/dist/spa ./dist/
cp -r dist/spa/* src-cordova/www/
cd src-cordova && cordova prepare ios
# Open in Xcode: platforms/ios/Soldout Event.xcworkspace
```

## Styling Guidelines

### SCSS Structure
```scss
@import '../css/quasar.variables';

.component-class {
  @include fnt(normal, normal);
  font-size: 14px;
  line-height: 21px;
  color: $dark-text-color;
  transition: all 0.3s ease;

  &:hover {
    opacity: 0.8;
  }
}
```

### Color Variables
- `$primary`: Main brand color
- `$dark-text-color`: Text on dark backgrounds
- `$form-border-unactive`: Input borders
- `$form-border-active`: Focused input borders
- Brand accent: `#FD3363` (pink/red)

### UI/UX Best Practices
- Use smooth transitions (0.2-0.3s ease)
- Provide immediate visual feedback
- Show loading states with spinner
- Display clear error messages
- Use animations for better UX (fade-in, slide)
- Make interactive elements clear (hover states)

## Common Issues & Solutions

### Issue: Node.js/Sass Compatibility
**Problem**: Modern Node.js + old Quasar v1 + node-sass incompatibility
**Solution**: Use Docker with Node 14 + sass@1.23.0

### Issue: CORS 403 on Mobile
**Problem**: iOS WKWebView sends OPTIONS preflight, ZUUL returns 403
**Solutions**:
1. Configure CORS in ZUUL with `allow-credentials: true`
2. Use `cordova-plugin-http` for native HTTP (bypasses CORS)
3. Avoid custom headers when possible

### Issue: Cordova deviceready Not Firing
**Problem**: Plugins not available, `window.cordova.plugin` undefined
**Solutions**:
1. Ensure `cordova.js` is loaded BEFORE app.js
2. Check `src/index.template.html` has `<script src="cordova.js">`
3. Wait for deviceready event before using plugins
4. Run `cordova prepare ios` to regenerate platform files

### Issue: App Hanging on Login Error
**Problem**: Login action throws exception, UI spinner never stops
**Solution**: Return `null` in catch block instead of throwing

### Issue: Auto-login Not Working
**Problem**: Saved credentials but still shows login screen
**Solution**: Save BOTH credentials AND auth state (accessToken + user data)

### Issue: iOS Signing Errors
**Problem**: "Signing requires a development team"
**Solution**: Open Xcode â†’ Signing & Capabilities â†’ Select Team (Apple ID)

## Development Workflow

### 1. Local Development (Web)
```bash
npm run dev
# Opens http://localhost:4200
```

### 2. iOS Development
```bash
# Build web assets
./rebuild-ios.sh

# Open in Xcode
open src-cordova/platforms/ios/Soldout\ Event.xcworkspace

# Clean Build Folder (Cmd+Shift+K)
# Run (Cmd+R)
```

### 3. Debugging iOS
```bash
# Safari Web Inspector
# 1. iPhone: Settings â†’ Safari â†’ Advanced â†’ Web Inspector: ON
# 2. Mac Safari: Develop â†’ [iPhone] â†’ Soldout Event
# 3. View Console logs, Network requests, Elements
```

### 4. Testing CORS
```bash
./test-cors.sh
# Shows if ZUUL CORS is configured correctly
```

## Code Quality

### ESLint Rules
- No trailing spaces
- Proper indentation
- Use `::v-deep` instead of deprecated `/deep/`

### Console Logging
```javascript
// Use descriptive emojis for better readability
console.log('ğŸ” LOGIN ATTEMPT:', {...})
console.log('âœ… SUCCESS:', data)
console.error('âŒ ERROR:', error)
console.warn('âš ï¸ WARNING:', warning)
```

### Error Handling
```javascript
try {
  const response = await apiCall()
  return response.data
} catch (err) {
  console.error('âŒ ERROR DETAILS ======')
  console.error('Status:', err.response?.status)
  console.error('Data:', err.response?.data)
  console.error('======================')
  
  // Store error for UI
  commit('setError', { error: {...} })
  
  // Don't throw - return null to prevent UI hanging
  return null
}
```

## Security Notes

### LocalStorage Data
- `userData`: { login, pass } - encrypted credentials (only if Remember Me)
- `savedAuth`: { accessToken, firstName, lastName, mail, phone } - session
- `rememberMe`: true/false - preference flag

### Token Management
- Access token stored in Vuex + LocalStorage (if Remember Me)
- Token format: `Bearer <JWT>`
- Auto-logout on token expiration (handle 401 responses)

## Testing

### Manual Testing Checklist
- [ ] Login with Remember Me checked â†’ works
- [ ] Close app â†’ reopen â†’ auto-logged in
- [ ] Login with Remember Me unchecked â†’ works
- [ ] Close app â†’ reopen â†’ login screen (no auto-login)
- [ ] Logout â†’ clears all data
- [ ] After logout â†’ close app â†’ reopen â†’ login screen
- [ ] 403 error â†’ shows error message (doesn't hang)
- [ ] Network error â†’ shows error message
- [ ] Invalid credentials â†’ shows error message

## Environment-Specific Notes

### TEST Environment
- URL: `https://z.test.soldout.com.ua`
- CORS: Configured with `allow-credentials: true`
- User: `soldout.oo.tt@gmail.com` / `aXLYjbfTNNN_soldout584`

### PROD Environment
- URL: `https://z.soldout.com.ua`
- CORS: Must have `allow-credentials: true`
- User: `y.oliinyk@stageshow.com.ua` / `dXrEj0RqjfY_`

## Key Commands

```bash
# Install dependencies
npm install

# Run dev server
npm run dev

# Build web
npx quasar build

# iOS rebuild
./rebuild-ios.sh

# Test CORS
./test-cors.sh

# Cordova commands
cd src-cordova
cordova platform add ios
cordova prepare ios
cordova plugin list
```

## Git Workflow

### Branch Strategy
- `main`: Production-ready code
- Feature branches for new features
- Commit often with clear messages

### Commit Message Format
```
feat: add new feature
fix: fix bug
chore: update dependencies
docs: update documentation
style: formatting changes
refactor: code restructuring
```

## AI Assistant Guidelines

When helping with this project:

1. **Always use Docker** for building web assets (Node 14 + sass@1.23.0)
2. **Check endpoints.js** to see which environment (TEST/PROD) is active
3. **Use `./rebuild-ios.sh`** for iOS builds instead of manual steps
4. **Remember LocalStorage keys**: userData, savedAuth, rememberMe
5. **Don't throw errors** in Vuex actions - return null to prevent UI hanging
6. **Always log detailed errors** for debugging (status, data, URL)
7. **Check Safari Console** for iOS debugging (not just Xcode logs)
8. **CORS issues**: Check if `allow-credentials: true` is set in ZUUL
9. **Cordova plugins**: Ensure deviceready fires before using plugins
10. **Clean Build** in Xcode after every code change for iOS

## Quick Reference

### Switch Environment
```javascript
// src/api/endpoints.js
const serviceUrl = 'https://z.soldout.com.ua'        // PROD
// const serviceUrl = 'https://z.test.soldout.com.ua' // TEST
```

### Update Credentials
```javascript
// src/pages/Login.vue
data() {
  return {
    email: 'user@example.com',
    pass: 'password'
  }
}
```

### Rebuild iOS
```bash
./rebuild-ios.sh
# Then in Xcode: Clean Build Folder â†’ Run
```

### Debug iOS
```bash
# Safari: Develop â†’ iPhone â†’ Soldout Event
# Check Console, Network, Elements tabs
```

## Important Notes

- **Never commit**: `node_modules/`, `dist/`, `src-cordova/platforms/`, `src-cordova/plugins/`, `src-cordova/www/`
- **Always commit**: Source files, config files, package.json
- **iOS Signing**: Requires manual setup in Xcode (cannot be automated)
- **Remember Me**: Stores both credentials AND auth state for instant login
- **Logout**: Must clear userData, savedAuth, AND rememberMe keys
- **Error Messages**: Show user-friendly messages, log technical details to console
- **Loading States**: Always stop spinner on error (don't leave UI hanging)

